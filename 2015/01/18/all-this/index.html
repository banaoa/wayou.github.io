<!DOCTYPE html><head><title>详解this | 刘哇勇的部落格</title><meta charset="UTF-8"><link href="/favicon.ico" rel="icon"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="author" content="Wayou Liu"><link rel="canonical" href="https://wayou.github.io/2015/01/18/all-this/"><meta name="description" content="this 虐我千百遍，看完此文效立见！不得不说，这篇文章的总结很地道很全面，适合收藏之用。原文：all this习惯了高级语言的你或许觉得JavaScript中的this跟Java这些面向对象语言相似，保存了实体属性的一些值。其实不然。将它视作幻影魔神比较恰当，手提一个装满未知符文的灵龛。以下内容我希望广大同行们能够了解。全是掏箱底的干货，其中大部分占用了我很多时间才掌握。"><meta name="keywords" content="javascript"><meta property="og:type" content="article"><meta property="og:title" content="详解this"><meta property="og:url" content="https://wayou.github.io/2015/01/18/all-this/index.html"><meta property="og:site_name" content="刘哇勇的部落格"><meta property="og:description" content="this 虐我千百遍，看完此文效立见！不得不说，这篇文章的总结很地道很全面，适合收藏之用。原文：all this习惯了高级语言的你或许觉得JavaScript中的this跟Java这些面向对象语言相似，保存了实体属性的一些值。其实不然。将它视作幻影魔神比较恰当，手提一个装满未知符文的灵龛。以下内容我希望广大同行们能够了解。全是掏箱底的干货，其中大部分占用了我很多时间才掌握。"><meta property="og:updated_time" content="2017-06-23T16:46:40.435Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="详解this"><meta name="twitter:description" content="this 虐我千百遍，看完此文效立见！不得不说，这篇文章的总结很地道很全面，适合收藏之用。原文：all this习惯了高级语言的你或许觉得JavaScript中的this跟Java这些面向对象语言相似，保存了实体属性的一些值。其实不然。将它视作幻影魔神比较恰当，手提一个装满未知符文的灵龛。以下内容我希望广大同行们能够了解。全是掏箱底的干货，其中大部分占用了我很多时间才掌握。"><meta name="twitter:creator" content="@liuwayong"><link rel="publisher" href="+WayouLiu"><meta property="fb:admins" content="liuwayong"><meta property="fb:app_id" content="liuwayong"><link href="/img/logo.png" rel="shortcut icon"><link rel="stylesheet" href="/lib/waves/waves.css"><link rel="stylesheet" href="/lib/tocbot/tocbot.css"><link rel="stylesheet" href="/style/style.css"><script>!function(e,a,t,n,c,o,s){e.GoogleAnalyticsObject=c,e[c]=e[c]||function(){(e[c].q=e[c].q||[]).push(arguments)},e[c].l=1*new Date,o=a.createElement(t),s=a.getElementsByTagName(t)[0],o.async=1,o.src="//www.google-analytics.com/analytics.js",s.parentNode.insertBefore(o,s)}(window,document,"script",0,"ga"),ga("create","UA-46794744-6","auto"),ga("send","pageview")</script><link rel="stylesheet" href="/css/prism-atom-dark.css" type="text/css"></head><body><header><div class="header-wrap clearfix"><div class="header-content"><a class="logo-wrap ink" href="/"><img class="logo" src="/logo.png" alt=""> <span class="site-name">刘哇勇的部落格</span></a><div class="menu-wrap"><div class="header-burger" onclick='document.body.classList.toggle("open")'><div></div></div></div></div><nav class="header-nav"><ul><li class="nav-item ink"><a class="nav-link" href="/">首页</a></li><li class="nav-item ink"><a class="nav-link" href="/archives">归档</a></li><li class="nav-item ink"><a class="nav-link" href="/about">关于</a></li><li class="nav-item ink"><a class="nav-link" href="/atom.xml">订阅</a></li></ul></nav></div></header><div class="container clearfix"><div class="col col-sidebar"><p></p><div class="toc js-toc"></div></div><div class="col col-main"><article><h1>详解this</h1><section class="post-info"><div class="post-date"><i class="material-icons md-dark">watch_later</i> 2015-01-18 20:01:00</div><div class="post-categories"><i class="material-icons md-dark">folder</i> <a class="category-link" href="/categories/译文/">译文</a></div><div class="post-tags"><i class="material-icons md-dark">local_offer</i> <a class="tag-link" href="/tags/javascript/">javascript</a></div></section><section class="post-content"><p><code>this</code> 虐我千百遍，看完此文效立见！不得不说，这篇文章的总结很地道很全面，适合收藏之用。</p><blockquote><p>原文：<a href="http://bjorn.tipling.com/all-this" target="_blank" rel="external">all this</a></p></blockquote><p>习惯了高级语言的你或许觉得JavaScript中的<code>this</code>跟Java这些面向对象语言相似，保存了实体属性的一些值。其实不然。将它视作<a href="http://harrypotter.wikia.com/wiki/Boggart" target="_blank" rel="external">幻影魔神</a>比较恰当，手提一个装满未知符文的<a href="http://harrypotter.wikia.com/wiki/Undetectable_Extension_Charm" target="_blank" rel="external">灵龛</a>。</p><p>以下内容我希望广大同行们能够了解。全是掏箱底的干货，其中大部分占用了我很多时间才掌握。</p><a id="more"></a><h2 id="全局this"><a href="/2015/01/18/all-this/#全局this" class="headerlink" title="全局this"></a>全局<code>this</code></h2><p>浏览器宿主的全局环境中，<code>this</code>指的是<code>window</code>对象。</p><pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text/javascript<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    console.log(this === window); //true
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>
</code></pre><p><a href="http://jsfiddle.net/btipling/hL9emz4m/" target="_blank" rel="external">示例</a></p><p>浏览器中在全局环境下，使用<code>var</code>声明变量其实就是赋值给<code>this</code>或<code>window</code>。</p><pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text/javascript<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    var foo = "bar";
    console.log(this.foo); //logs "bar"
    console.log(window.foo); //logs "bar"
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>
</code></pre><p><a href="http://jsfiddle.net/btipling/25xkmho7/1/" target="_blank" rel="external">示例</a></p><p>任何情况下，创建变量时没有使用<code>var</code>或者<code>let</code>(ECMAScript 6)，也是在操作全局<code>this</code>。</p><pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text/javascript<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    foo = "bar";

    function testThis() {
      foo = "foo";
    }

    console.log(this.foo); //logs "bar"
    testThis();
    console.log(this.foo); //logs "foo"
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>
</code></pre><p><a href="http://jsfiddle.net/btipling/25xkmho7/3/" target="_blank" rel="external">示例</a></p><p>Node命令行（REPL）中，<code>this</code>是全局命名空间。可以通过<code>global</code>来访问。</p><pre class="language-bash"><code class="language-bash"><span class="token operator">></span> this
<span class="token punctuation">{</span> ArrayBuffer: <span class="token punctuation">[</span>Function: ArrayBuffer<span class="token punctuation">]</span>,
  Int8Array: <span class="token punctuation">{</span> <span class="token punctuation">[</span>Function: Int8Array<span class="token punctuation">]</span> BYTES_PER_ELEMENT: 1 <span class="token punctuation">}</span>,
  Uint8Array: <span class="token punctuation">{</span> <span class="token punctuation">[</span>Function: Uint8Array<span class="token punctuation">]</span> BYTES_PER_ELEMENT: 1 <span class="token punctuation">}</span>,
  <span class="token punctuation">..</span>.
<span class="token operator">></span> global <span class="token operator">==</span><span class="token operator">=</span> this
<span class="token boolean">true</span>
</code></pre><p>在Node环境里执行的JS脚本中，<code>this</code>其实是个空对象，有别于<code>global</code>。</p><pre class="language-js"><code class="language-js">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token operator">===</span> global<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><pre class="language-bash"><code class="language-bash">$ node test.js
<span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token boolean">false</span>
</code></pre><p>当尝试在Node中执行JS脚本时，脚本中全局作用域中的<code>var</code>并不会将变量赋值给全局<code>this</code>，这与在浏览器中是不一样的。</p><pre class="language-js"><code class="language-js"><span class="token keyword">var</span> foo <span class="token operator">=</span> <span class="token string">"bar"</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>foo<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><pre class="language-bash"><code class="language-bash">$ node test.js
undefined
</code></pre><p>…但在命令行里进行求值却会赋值到<code>this</code>身上。</p><pre class="language-bash"><code class="language-bash"><span class="token operator">></span> var foo <span class="token operator">=</span> <span class="token string">"bar"</span><span class="token punctuation">;</span>
<span class="token operator">></span> this.foo
bar
<span class="token operator">></span> global.foo
bar
</code></pre><p>在Node里执行的脚本中，创建变量时没带<code>var</code>或<code>let</code>关键字，会赋值给全局的<code>global</code>但不是<code>this</code>（译注：上面已经提到<code>this</code>和<code>global</code>不是同一个对象，所以这里就不奇怪了）。</p><pre class="language-js"><code class="language-js">foo <span class="token operator">=</span> <span class="token string">"bar"</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>foo<span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>global<span class="token punctuation">.</span>foo<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><pre class="language-bash"><code class="language-bash">$ node test.js
undefined
bar
</code></pre><p>但在Node命令行里，就会赋值给两者了。</p><blockquote><p>译注：简单来说，Node脚本中<code>global</code>和<code>this</code>是区别对待的，而Node命令行中，两者可等效为同一对象。</p></blockquote><h2 id="函数或方法里的this"><a href="/2015/01/18/all-this/#函数或方法里的this" class="headerlink" title="函数或方法里的this"></a>函数或方法里的<code>this</code></h2><p>除了DOM的事件回调或者提供了执行上下文（后面会提到）的情况，函数正常被调用（不带<code>new</code>）时，里面的<code>this</code>指向的是全局作用域。</p><pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text/javascript<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    foo = "bar";

    function testThis() {
      this.foo = "foo";
    }

    console.log(this.foo); //logs "bar"
    testThis();
    console.log(this.foo); //logs "foo"
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>
</code></pre><p><a href="http://jsfiddle.net/btipling/25xkmho7/4/" target="_blank" rel="external">示例</a></p><pre class="language-js"><code class="language-js">foo <span class="token operator">=</span> <span class="token string">"bar"</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> testThis <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>foo <span class="token operator">=</span> <span class="token string">"foo"</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>global<span class="token punctuation">.</span>foo<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">testThis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>global<span class="token punctuation">.</span>foo<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><pre class="language-bash"><code class="language-bash">$ node test.js
bar
foo
</code></pre><p>还有个例外，就是使用了<code>&quot;use strict&quot;;</code>。此时<code>this</code>是<code>undefined</code>。</p><pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text/javascript<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    foo = "bar";

    function testThis() {
      "use strict";
      this.foo = "foo";
    }

    console.log(this.foo); //logs "bar"
    testThis();  //Uncaught TypeError: Cannot set property 'foo' of undefined
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>
</code></pre><p><a href="http://jsfiddle.net/btipling/25xkmho7/51/" target="_blank" rel="external">示例</a></p><p>当用调用函数时使用了<code>new</code>关键字，此刻<code>this</code>指代一个新的上下文，不再指向全局<code>this</code>。</p><pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text/javascript<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    foo = "bar";

    function testThis() {
      this.foo = "foo";
    }

    console.log(this.foo); //logs "bar"
    new testThis();
    console.log(this.foo); //logs "bar"

    console.log(new testThis().foo); //logs "foo"
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>
</code></pre><p><a href="http://jsfiddle.net/btipling/25xkmho7/6/" target="_blank" rel="external">示例</a></p><p>通常我将这个新的上下文称作实例。</p><h2 id="原型中的this"><a href="/2015/01/18/all-this/#原型中的this" class="headerlink" title="原型中的this"></a>原型中的<code>this</code></h2><p>函数创建后其实以一个函数对象的形式存在着。既然是对象，则自动获得了一个叫做<code>prototype</code>的属性，可以自由地对这个属性进行赋值。当配合<code>new</code>关键字来调用一个函数创建实例后，此刻便能直接访问到原型身上的值。</p><pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">Thing</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>foo<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

Thing<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>foo <span class="token operator">=</span> <span class="token string">"bar"</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> thing <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thing</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//logs "bar"</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>thing<span class="token punctuation">.</span>foo<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">//logs "bar"</span>
</code></pre><p><a href="http://jsfiddle.net/btipling/25xkmho7/8/" target="_blank" rel="external">示例</a></p><p>当通过<code>new</code>的方式创建了多个实例后，他们会共用一个原型。比如，每个实例的<code>this.foo</code>都返回相同的值，直到<code>this.foo</code>被重写。</p><pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">Thing</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
Thing<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>foo <span class="token operator">=</span> <span class="token string">"bar"</span><span class="token punctuation">;</span>
Thing<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>logFoo <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>foo<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
Thing<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>setFoo <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>newFoo<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>foo <span class="token operator">=</span> newFoo<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> thing1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thing</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> thing2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thing</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

thing1<span class="token punctuation">.</span><span class="token function">logFoo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//logs "bar"</span>
thing2<span class="token punctuation">.</span><span class="token function">logFoo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//logs "bar"</span>

thing1<span class="token punctuation">.</span><span class="token function">setFoo</span><span class="token punctuation">(</span><span class="token string">"foo"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
thing1<span class="token punctuation">.</span><span class="token function">logFoo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//logs "foo";</span>
thing2<span class="token punctuation">.</span><span class="token function">logFoo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//logs "bar";</span>

thing2<span class="token punctuation">.</span>foo <span class="token operator">=</span> <span class="token string">"foobar"</span><span class="token punctuation">;</span>
thing1<span class="token punctuation">.</span><span class="token function">logFoo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//logs "foo";</span>
thing2<span class="token punctuation">.</span><span class="token function">logFoo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//logs "foobar";</span>
</code></pre><p><a href="http://jsfiddle.net/btipling/25xkmho7/9/" target="_blank" rel="external">示例</a></p><p>在实例中，<code>this</code>是个特殊的对象，而<code>this</code>自身其实只是个关键字。你可以把<code>this</code>想象成在实例中获取原型值的一种途径，同时对<code>this</code>赋值又会覆盖原型上的值。完全可以将新增的值从原型中删除从而将原型还原为初始状态。</p><pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">Thing</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
Thing<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>foo <span class="token operator">=</span> <span class="token string">"bar"</span><span class="token punctuation">;</span>
Thing<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>logFoo <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>foo<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
Thing<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>setFoo <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>newFoo<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>foo <span class="token operator">=</span> newFoo<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
Thing<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>deleteFoo <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">delete</span> <span class="token keyword">this</span><span class="token punctuation">.</span>foo<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> thing <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thing</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
thing<span class="token punctuation">.</span><span class="token function">setFoo</span><span class="token punctuation">(</span><span class="token string">"foo"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
thing<span class="token punctuation">.</span><span class="token function">logFoo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//logs "foo";</span>
thing<span class="token punctuation">.</span><span class="token function">deleteFoo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
thing<span class="token punctuation">.</span><span class="token function">logFoo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//logs "bar";</span>
thing<span class="token punctuation">.</span>foo <span class="token operator">=</span> <span class="token string">"foobar"</span><span class="token punctuation">;</span>
thing<span class="token punctuation">.</span><span class="token function">logFoo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//logs "foobar";</span>
<span class="token keyword">delete</span> thing<span class="token punctuation">.</span>foo<span class="token punctuation">;</span>
thing<span class="token punctuation">.</span><span class="token function">logFoo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//logs "bar";</span>
</code></pre><p><a href="http://jsfiddle.net/btipling/25xkmho7/11/" target="_blank" rel="external">示例</a></p><p>…或者不通过实例，直接操作函数的原型。</p><pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">Thing</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
Thing<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>foo <span class="token operator">=</span> <span class="token string">"bar"</span><span class="token punctuation">;</span>
Thing<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>logFoo <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>foo<span class="token punctuation">,</span> Thing<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>foo<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> thing <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thing</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
thing<span class="token punctuation">.</span>foo <span class="token operator">=</span> <span class="token string">"foo"</span><span class="token punctuation">;</span>
thing<span class="token punctuation">.</span><span class="token function">logFoo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//logs "foo bar";</span>
</code></pre><p><a href="http://jsfiddle.net/btipling/25xkmho7/12/" target="_blank" rel="external">示例</a></p><p>同一函数创建的所有实例均共享一个原型。如果你给原型赋值了一个数组，那么所有实例都能获取到这个数组。除非你在某个实例中对其进行了重写，实事上是进行了覆盖。</p><pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">Thing</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
Thing<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>things <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>


<span class="token keyword">var</span> thing1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thing</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> thing2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thing</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
thing1<span class="token punctuation">.</span>things<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">"foo"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>thing2<span class="token punctuation">.</span>things<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//logs ["foo"]</span>
</code></pre><p><a href="http://jsfiddle.net/btipling/25xkmho7/13/" target="_blank" rel="external">示例</a></p><p>通常上面的做法是不正确的（译注：改变<code>thing1</code>的同时也影响了<code>thing2</code>）。如果你想每个实例互不影响，那么请在函数里创建这些值，而不是在原型上。</p><pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">Thing</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>things <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>


<span class="token keyword">var</span> thing1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thing</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> thing2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thing</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
thing1<span class="token punctuation">.</span>things<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">"foo"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>thing1<span class="token punctuation">.</span>things<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//logs ["foo"]</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>thing2<span class="token punctuation">.</span>things<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//logs []</span>
</code></pre><p><a href="http://jsfiddle.net/btipling/25xkmho7/14/" target="_blank" rel="external">示例</a></p><p>多个函数可以形成原型链，这样<code>this</code>便会在原型链上逐步往上找直到找到你想引用的值。</p><pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">Thing1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
Thing1<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>foo <span class="token operator">=</span> <span class="token string">"bar"</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">Thing2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
Thing2<span class="token punctuation">.</span>prototype <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thing1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token keyword">var</span> thing <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thing2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>thing<span class="token punctuation">.</span>foo<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//logs "bar"</span>
</code></pre><p><a href="http://jsfiddle.net/btipling/25xkmho7/15/" target="_blank" rel="external">示例</a></p><p>很多人便是利用这个特性在JS中模拟经典的对象继承。</p><p>注意原型链底层函数中对<code>this</code>的操作会覆盖上层的值。</p><pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">Thing1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
Thing1<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>foo <span class="token operator">=</span> <span class="token string">"bar"</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">Thing2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>foo <span class="token operator">=</span> <span class="token string">"foo"</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
Thing2<span class="token punctuation">.</span>prototype <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thing1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">Thing3</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
Thing3<span class="token punctuation">.</span>prototype <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thing2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token keyword">var</span> thing <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thing3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>thing<span class="token punctuation">.</span>foo<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//logs "foo"</span>
</code></pre><p><a href="http://jsfiddle.net/btipling/25xkmho7/16/" target="_blank" rel="external">示例</a></p><p>我习惯将赋值到原型上的函数称作方法。上面某些地方便使用了方法这样的字眼，比如<code>logFoo</code>方法。这些方法中的<code>this</code>同样具有在原型链上查找引用的魔力。通常将最初用来创建实例的函数称作构造函数。</p><p>原型链方法中的<code>this</code>是从实例中的<code>this</code>开始住上查找整个原型链的。也就是说，如果原型链中某个地方直接对<code>this</code>进行赋值覆盖了某个变量，那么我们拿到 的是覆盖后的值。</p><pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">Thing1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
Thing1<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>foo <span class="token operator">=</span> <span class="token string">"bar"</span><span class="token punctuation">;</span>
Thing1<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>logFoo <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>foo<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">Thing2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>foo <span class="token operator">=</span> <span class="token string">"foo"</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
Thing2<span class="token punctuation">.</span>prototype <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thing1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token keyword">var</span> thing <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thing2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
thing<span class="token punctuation">.</span><span class="token function">logFoo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//logs "foo";</span>
</code></pre><p><a href="http://jsfiddle.net/btipling/25xkmho7/17/" target="_blank" rel="external">示例</a></p><p>在JavaScript中，函数可以嵌套函数，也就是你可以在函数里面继续定义函数。但内层函数是通过闭包获取外层函数里定义的变量值的，而不是直接继承<code>this</code>。</p><pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">Thing</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
Thing<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>foo <span class="token operator">=</span> <span class="token string">"bar"</span><span class="token punctuation">;</span>
Thing<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>logFoo <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> info <span class="token operator">=</span> <span class="token string">"attempting to log this.foo:"</span><span class="token punctuation">;</span>
    <span class="token keyword">function</span> <span class="token function">doIt</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>info<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>foo<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">doIt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>


<span class="token keyword">var</span> thing <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thing</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
thing<span class="token punctuation">.</span><span class="token function">logFoo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">//logs "attempting to log this.foo: undefined"</span>
</code></pre><p><a href="http://jsfiddle.net/btipling/25xkmho7/21/" target="_blank" rel="external">示例</a></p><p>上面示例中，<code>doIt</code> 函数中的<code>this</code>指代是全局作用域或者是<code>undefined</code>如果使用了<code>&quot;use strict&quot;;</code>声明的话。对于很多新手来说，理解这点是非常头疼的。</p><p>还有更奇葩的。把实例的方法作为参数传递时，实例是不会跟着过去的。也就是说，此时方法中的<code>this</code>在调用时指向的是全局<code>this</code>或者是<code>undefined</code>在声明了<code>&quot;use strict&quot;;</code>时。</p><pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">Thing</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
Thing<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>foo <span class="token operator">=</span> <span class="token string">"bar"</span><span class="token punctuation">;</span>
Thing<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>logFoo <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>foo<span class="token punctuation">)</span><span class="token punctuation">;</span>   
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">doIt</span><span class="token punctuation">(</span>method<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">method</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>


<span class="token keyword">var</span> thing <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thing</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
thing<span class="token punctuation">.</span><span class="token function">logFoo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//logs "bar"</span>
<span class="token function">doIt</span><span class="token punctuation">(</span>thing<span class="token punctuation">.</span>logFoo<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//logs undefined</span>
</code></pre><p><a href="http://jsfiddle.net/btipling/25xkmho7/22/" target="_blank" rel="external">示例</a></p><p>所以很多人习惯将<code>this</code>缓存起来，用个叫<code>self</code>或者其他什么的变量来保存，以将外层与内层的<code>this</code>区分开来。</p><pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">Thing</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
Thing<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>foo <span class="token operator">=</span> <span class="token string">"bar"</span><span class="token punctuation">;</span>
Thing<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>logFoo <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> self <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> info <span class="token operator">=</span> <span class="token string">"attempting to log this.foo:"</span><span class="token punctuation">;</span>
    <span class="token keyword">function</span> <span class="token function">doIt</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>info<span class="token punctuation">,</span> self<span class="token punctuation">.</span>foo<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">doIt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>


<span class="token keyword">var</span> thing <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thing</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
thing<span class="token punctuation">.</span><span class="token function">logFoo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">//logs "attempting to log this.foo: bar"</span>
</code></pre><p><a href="http://jsfiddle.net/btipling/25xkmho7/23/" target="_blank" rel="external">示例</a></p><p>…但上面的方式不是万能的，在将方法做为参数传递时，就不起作用了。</p><pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">Thing</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
Thing<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>foo <span class="token operator">=</span> <span class="token string">"bar"</span><span class="token punctuation">;</span>
Thing<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>logFoo <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> self <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token keyword">function</span> <span class="token function">doIt</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>foo<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">doIt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">doItIndirectly</span><span class="token punctuation">(</span>method<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">method</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>


<span class="token keyword">var</span> thing <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thing</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
thing<span class="token punctuation">.</span><span class="token function">logFoo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//logs "bar"</span>
<span class="token function">doItIndirectly</span><span class="token punctuation">(</span>thing<span class="token punctuation">.</span>logFoo<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//logs undefined</span>
</code></pre><p><a href="http://jsfiddle.net/btipling/25xkmho7/24/" target="_blank" rel="external">示例</a></p><p>解决方法就是传递的时候使用<code>bind</code>方法显示指明上下文，<code>bind</code>方法是所有函数或方法都具有的。</p><pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">Thing</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
Thing<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>foo <span class="token operator">=</span> <span class="token string">"bar"</span><span class="token punctuation">;</span>
Thing<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>logFoo <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>foo<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">doIt</span><span class="token punctuation">(</span>method<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">method</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>


<span class="token keyword">var</span> thing <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thing</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">doIt</span><span class="token punctuation">(</span>thing<span class="token punctuation">.</span>logFoo<span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>thing<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//logs bar</span>
</code></pre><p><a href="http://jsfiddle.net/btipling/25xkmho7/25/" target="_blank" rel="external">示例</a></p><p>同时也可以使用<code>apply</code>或<code>call</code> 来调用该方法或函数，让它在一个新的上下文中执行。</p><pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">Thing</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
Thing<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>foo <span class="token operator">=</span> <span class="token string">"bar"</span><span class="token punctuation">;</span>
Thing<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>logFoo <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">function</span> <span class="token function">doIt</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>foo<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    doIt<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">doItIndirectly</span><span class="token punctuation">(</span>method<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">method</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>


<span class="token keyword">var</span> thing <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thing</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">doItIndirectly</span><span class="token punctuation">(</span>thing<span class="token punctuation">.</span>logFoo<span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>thing<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//logs bar</span>
</code></pre><p><a href="http://jsfiddle.net/btipling/25xkmho7/26/" target="_blank" rel="external">示例</a></p><p>使用<code>bind</code>可以任意改变函数或方法的执行上下文，即使它没有被绑定到一个实例的原型上。</p><pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">Thing</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
Thing<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>foo <span class="token operator">=</span> <span class="token string">"bar"</span><span class="token punctuation">;</span>


<span class="token keyword">function</span> <span class="token function">logFoo</span><span class="token punctuation">(</span>aStr<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>aStr<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>foo<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>


<span class="token keyword">var</span> thing <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thing</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
logFoo<span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>thing<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token string">"using bind"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//logs "using bind bar"</span>
logFoo<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>thing<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">"using apply"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//logs "using apply bar"</span>
logFoo<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>thing<span class="token punctuation">,</span> <span class="token string">"using call"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//logs "using call bar"</span>
<span class="token function">logFoo</span><span class="token punctuation">(</span><span class="token string">"using nothing"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//logs "using nothing undefined"</span>
</code></pre><p><a href="http://jsfiddle.net/btipling/25xkmho7/27/" target="_blank" rel="external">示例</a></p><p>避免在构造函数中返回作何东西，因为返回的东西可能覆盖本来该返回的实例。</p><pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">Thing</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
Thing<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>foo <span class="token operator">=</span> <span class="token string">"bar"</span><span class="token punctuation">;</span>


Thing<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>logFoo <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>foo<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>


<span class="token keyword">var</span> thing <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thing</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
thing<span class="token punctuation">.</span><span class="token function">logFoo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//Uncaught TypeError: undefined is not a function</span>
</code></pre><p><a href="http://jsfiddle.net/btipling/25xkmho7/28/" target="_blank" rel="external">示例</a></p><p>但，如果你在构造函数里返回的是个原始值比如字符串或者数字什么的，上面的错误就不会发生了，返回语句将被忽略。所以最好别在一个将要通过<code>new</code>来调用的构造函数中返回作何东西，即使你是清醒的。如果你想实现工厂模式，那么请用一个函数来创建实例，并且不通过<code>new</code>来调用。当然这只是个人建议。</p><p>诚然，你也可以使用<code>Object.create</code>从而避免使用<code>new</code>。这样也能创建一个实例。</p><pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">Thing</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
Thing<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>foo <span class="token operator">=</span> <span class="token string">"bar"</span><span class="token punctuation">;</span>


Thing<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>logFoo <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>foo<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>


<span class="token keyword">var</span> thing <span class="token operator">=</span>  Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>Thing<span class="token punctuation">.</span>prototype<span class="token punctuation">)</span><span class="token punctuation">;</span>
thing<span class="token punctuation">.</span><span class="token function">logFoo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//logs "bar"</span>
</code></pre><p><a href="http://jsfiddle.net/btipling/25xkmho7/29/" target="_blank" rel="external">示例</a></p><p>这种方式不会调用该构造函数。</p><pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">Thing</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>foo <span class="token operator">=</span> <span class="token string">"foo"</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
Thing<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>foo <span class="token operator">=</span> <span class="token string">"bar"</span><span class="token punctuation">;</span>


Thing<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>logFoo <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>foo<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>


<span class="token keyword">var</span> thing <span class="token operator">=</span>  Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>Thing<span class="token punctuation">.</span>prototype<span class="token punctuation">)</span><span class="token punctuation">;</span>
thing<span class="token punctuation">.</span><span class="token function">logFoo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//logs "bar"</span>
</code></pre><p><a href="http://jsfiddle.net/btipling/25xkmho7/30/" target="_blank" rel="external">示例</a></p><p>正因为<code>Object.create</code>没有调用构造函数，这在当你想实现一个继承时是非常有用的，随后你可能想要重写构造函数。</p><pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">Thing1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>foo <span class="token operator">=</span> <span class="token string">"foo"</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
Thing1<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>foo <span class="token operator">=</span> <span class="token string">"bar"</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">Thing2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">logFoo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//logs "bar"</span>
    Thing1<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">logFoo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//logs "foo"</span>
<span class="token punctuation">}</span>
Thing2<span class="token punctuation">.</span>prototype <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>Thing1<span class="token punctuation">.</span>prototype<span class="token punctuation">)</span><span class="token punctuation">;</span>
Thing2<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>logFoo <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>foo<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> thing <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thing2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p><a href="http://jsfiddle.net/btipling/25xkmho7/32/" target="_blank" rel="external">示例</a></p><h2 id="对象中的this"><a href="/2015/01/18/all-this/#对象中的this" class="headerlink" title="对象中的this"></a>对象中的<code>this</code></h2><p>可以在对象的任何方法中使用<code>this</code>来访问该对象的属性。这与用<code>new</code>得到的实例是不一样的。</p><pre class="language-js"><code class="language-js"><span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
    foo<span class="token punctuation">:</span> <span class="token string">"bar"</span><span class="token punctuation">,</span>
    logFoo<span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>foo<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

obj<span class="token punctuation">.</span><span class="token function">logFoo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//logs "bar"</span>
</code></pre><p><a href="http://jsfiddle.net/btipling/25xkmho7/33/" target="_blank" rel="external">示例</a></p><p>注意这里并没有使用<code>new</code>，也没有用<code>Object.create</code>，更没有函数的调用来创建对象。也可以将函数绑定到对象，就好像这个对象是一个实例一样。</p><pre class="language-js"><code class="language-js"><span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
    foo<span class="token punctuation">:</span> <span class="token string">"bar"</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">logFoo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>foo<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

logFoo<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//logs "bar"</span>
</code></pre><p><a href="http://jsfiddle.net/btipling/25xkmho7/34/" target="_blank" rel="external">示例</a></p><p>此时使用<code>this</code>没有向上查找原型链的复杂工序。通过<code>this</code>所拿到的只是该对象身上的属性而以。</p><pre class="language-js"><code class="language-js"><span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
    foo<span class="token punctuation">:</span> <span class="token string">"bar"</span><span class="token punctuation">,</span>
    deeper<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        logFoo<span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>foo<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

obj<span class="token punctuation">.</span>deeper<span class="token punctuation">.</span><span class="token function">logFoo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//logs undefined</span>
</code></pre><p><a href="http://jsfiddle.net/btipling/25xkmho7/35/" target="_blank" rel="external">示例</a></p><p>也可以不通过<code>this</code>，直接访问对象的属性。</p><pre class="language-js"><code class="language-js"><span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
    foo<span class="token punctuation">:</span> <span class="token string">"bar"</span><span class="token punctuation">,</span>
    deeper<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        logFoo<span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>foo<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

obj<span class="token punctuation">.</span>deeper<span class="token punctuation">.</span><span class="token function">logFoo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//logs "bar"</span>
</code></pre><p><a href="http://jsfiddle.net/btipling/25xkmho7/36/" target="_blank" rel="external">示例</a></p><h2 id="DOM-事件回调中的this"><a href="/2015/01/18/all-this/#DOM-事件回调中的this" class="headerlink" title="DOM 事件回调中的this"></a>DOM 事件回调中的<code>this</code></h2><p>在DOM事件的处理函数中，<code>this</code>指代的是被绑定该事件的DOM元素。</p><pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">Listener</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"foo"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"click"</span><span class="token punctuation">,</span>
       <span class="token keyword">this</span><span class="token punctuation">.</span>handleClick<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
Listener<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>handleClick <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>event<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//logs "&lt;div id="foo">&lt;/div>"</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> listener <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Listener</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"foo"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p><a href="http://jsfiddle.net/btipling/25xkmho7/37/" target="_blank" rel="external">示例</a></p><p>…除非你通过<code>bind</code>人为改变了事件处理器的执行上下文。</p><pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">Listener</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"foo"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"click"</span><span class="token punctuation">,</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>handleClick<span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
Listener<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>handleClick <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>event<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//logs Listener {handleClick: function}</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> listener <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Listener</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"foo"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p><a href="http://jsfiddle.net/btipling/25xkmho7/38/" target="_blank" rel="external">示例</a></p><h2 id="HTML中的this"><a href="/2015/01/18/all-this/#HTML中的this" class="headerlink" title="HTML中的this"></a>HTML中的<code>this</code></h2><p>HTML标签的属性中是可能写JS的，这种情况下<code>this</code>指代该HTML元素。</p><pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>foo<span class="token punctuation">"</span></span> <span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>console.log(this);<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text/javascript<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
document.getElementById("foo").click(); //logs &lt;div id="foo"...
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>
</code></pre><p><a href="http://jsfiddle.net/btipling/25xkmho7/40/" target="_blank" rel="external">示例</a></p><h2 id="重写this"><a href="/2015/01/18/all-this/#重写this" class="headerlink" title="重写this"></a>重写<code>this</code></h2><p>无法重写<code>this</code>，因为它是一个关键字。</p><pre class="language-js"><code class="language-js"><span class="token keyword">function</span> test <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> <span class="token keyword">this</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">// Uncaught SyntaxError: Unexpected token this</span>
<span class="token punctuation">}</span>
</code></pre><p><a href="http://jsfiddle.net/btipling/25xkmho7/41/" target="_blank" rel="external">示例</a></p><h2 id="eval中的this"><a href="/2015/01/18/all-this/#eval中的this" class="headerlink" title="eval中的this"></a><code>eval</code>中的<code>this</code></h2><p><code>eval</code> 中也可以正确获取当前的 <code>this</code>。</p><pre class="language-js"><code class="language-js"><span class="token keyword">function</span> Thing <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
Thing<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>foo <span class="token operator">=</span> <span class="token string">"bar"</span><span class="token punctuation">;</span>
Thing<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>logFoo <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">eval</span><span class="token punctuation">(</span><span class="token string">"console.log(this.foo)"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//logs "bar"</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> thing <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thing</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
thing<span class="token punctuation">.</span><span class="token function">logFoo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p><a href="http://jsfiddle.net/btipling/25xkmho7/43/" target="_blank" rel="external">示例</a></p><p>这里存在安全隐患。最好的办法就是避免使用<code>eval</code>。</p><p>使用<code>Function</code>关键字创建的函数也可以获取<code>this</code>：</p><pre class="language-js"><code class="language-js"><span class="token keyword">function</span> Thing <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
Thing<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>foo <span class="token operator">=</span> <span class="token string">"bar"</span><span class="token punctuation">;</span>
Thing<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>logFoo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Function</span><span class="token punctuation">(</span><span class="token string">"console.log(this.foo);"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> thing <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thing</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
thing<span class="token punctuation">.</span><span class="token function">logFoo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//logs "bar"</span>
</code></pre><p><a href="http://jsfiddle.net/btipling/25xkmho7/44/" target="_blank" rel="external">示例</a></p><h2 id="使用with时的this"><a href="/2015/01/18/all-this/#使用with时的this" class="headerlink" title="使用with时的this"></a>使用<code>with</code>时的<code>this</code></h2><p>使用<code>with</code>可以将<code>this</code>人为添加到当前执行环境中而不需要显示地引用<code>this</code>。</p><pre class="language-js"><code class="language-js"><span class="token keyword">function</span> Thing <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
Thing<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>foo <span class="token operator">=</span> <span class="token string">"bar"</span><span class="token punctuation">;</span>
Thing<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>logFoo <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">with</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>foo<span class="token punctuation">)</span><span class="token punctuation">;</span>
        foo <span class="token operator">=</span> <span class="token string">"foo"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> thing <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thing</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
thing<span class="token punctuation">.</span><span class="token function">logFoo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// logs "bar"</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>thing<span class="token punctuation">.</span>foo<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// logs "foo"</span>
</code></pre><p><a href="http://jsfiddle.net/btipling/25xkmho7/45/" target="_blank" rel="external">示例</a></p><p>正如很多人认为的那样，使用<code>with</code>是不好的，因为会产生歧义。</p><h2 id="jQuery中的this"><a href="/2015/01/18/all-this/#jQuery中的this" class="headerlink" title="jQuery中的this"></a>jQuery中的<code>this</code></h2><p>一如HTML DOM元素的事件回调，jQuery库中大多地方的<code>this</code>也是指代的DOM元素。页面上的事件回调和一些便利的静态方法比如<code>$.each</code> 都是这样的。</p><pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>foo bar1<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>foo bar2<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text/javascript<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
$(".foo").each(function () {
    console.log(this); //logs &lt;div class="foo...
});
$(".foo").on("click", function () {
    console.log(this); //logs &lt;div class="foo...
});
$(".foo").each(function () {
    this.click();
});
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>
</code></pre><p><a href="http://jsfiddle.net/btipling/25xkmho7/47/" target="_blank" rel="external">示例</a></p><h2 id="传递-this"><a href="/2015/01/18/all-this/#传递-this" class="headerlink" title="传递 this"></a>传递 <code>this</code></h2><p>如果你用过<a href="http://underscorejs.org/" target="_blank" rel="external">underscore.js</a>或者<a href="http://lodash.com/" target="_blank" rel="external">lo-dash</a>你便知道，这两个库中很多方法你可以传递一个参数来显示指定执行的上下文。比如<code>_.each</code>。自ECMAScript 5 标准后，一些原生的JS方法也允许传递上下文，比如<code>forEach</code>。事实上，上文提到的<code>bind</code>，<code>apply</code>还有<code>call</code> 已经给我们手动指定函数执行上下文的能力了。</p><pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">Thing</span><span class="token punctuation">(</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>type <span class="token operator">=</span> type<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
Thing<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>log <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>thing<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>type<span class="token punctuation">,</span> thing<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
Thing<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>logThings <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>arr<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   arr<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>log<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// logs "fruit apples..."</span>
   _<span class="token punctuation">.</span><span class="token function">each</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>log<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//logs "fruit apples..."</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> thing <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thing</span><span class="token punctuation">(</span><span class="token string">"fruit"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
thing<span class="token punctuation">.</span><span class="token function">logThings</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"apples"</span><span class="token punctuation">,</span> <span class="token string">"oranges"</span><span class="token punctuation">,</span> <span class="token string">"strawberries"</span><span class="token punctuation">,</span> <span class="token string">"bananas"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p><a href="http://jsfiddle.net/btipling/25xkmho7/50/" target="_blank" rel="external">示例</a></p><p>这样可以使得代码简洁些，不用层层嵌套<code>bind</code>，也不用不断地缓存<code>this</code>。</p><p>一些编程语言上手很简单，比如<a href="http://golang.org/" target="_blank" rel="external">Go语言手册</a>可以被快速读完。然后你差不多就掌握这门语言了，只是在实战时会有些小的问题或陷阱在等着你。</p><p>而JavaScript不是这样的。手册难读。非常多缺陷在里面，以至于人们抽离出了<code>它好的部分</code>（<a href="http://www.amazon.com/JavaScript-Good-Parts-Douglas-Crockford/dp/0596517742" target="_blank" rel="external">The Good Parts</a>）。最好的文档可能是<a href="https://developer.mozilla.org/en-US/" target="_blank" rel="external">MDN</a>上的了。所以我建议你看看他上面关于<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/this" target="_blank" rel="external"><code>this</code></a>的介绍，并且始终在搜索JS相关问题时加上”mdn” 来获得最好的文档资料。静态代码检查也是个不错的工具，比如<a href="http://www.jshint.com/" target="_blank" rel="external">jshint</a>。</p><p>欢迎勘误及讨论，我的推特@bjorntipling。</p></section></article><div class="pager"><a class="post-prev pager-item" href="/2015/03/08/redirect-before-routing-in-angular/"><strong class="article-nav-caption">上一篇</strong><p class="post-nav-title truncate-text">Angular条件路由</p></a><a class="post-next pager-item" href="/2014/12/31/chrome-request-stalled-problem/"><strong class="article-nav-caption">下一篇</strong><p class="post-nav-title truncate-text">关于请求被挂起页面加载缓慢问题的追查（01/13更）</p></a></div><div class="comment-section"><div id="disqus_thread"></div><script>var disqus_config=function(){this.page.url="https://wayou.github.io/2015/01/18/all-this/",this.page.identifier="_posts/2015-01-18-all-this.md"};!function(){var t=document,e=t.createElement("script");e.src="//wayou.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script></div></div></div><footer class="footer"><p>由<a href="http://hexo.io/" target="_blank">Hexo</a>强力驱动，搭载<a title="under developing..." href="javascript:;">末名</a>主题</p><p>&copy; 2017 Wayou Liu</p></footer><script src="/lib/waves/waves.js"></script><script src="/lib/tocbot/tocbot.js"></script><script src="/js/main.js"></script></body>