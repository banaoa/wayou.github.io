<!DOCTYPE html><head><title></title><meta charset="UTF-8"><link href="/favicon.ico" rel="icon"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="author" content="Wayou Liu"><meta name="description" content="share thoughts on web developing"><meta name="keywords" content="frontend,dev,software,web,react,js,css,html,javascript,china,chinese,github,angularjs"><link href="/img/logo.png" rel="shortcut icon"><link rel="stylesheet" href="/lib/waves/waves.css"><link rel="stylesheet" href="/lib/tocbot/tocbot.css"><link rel="stylesheet" href="/style/style.css"><link rel="stylesheet" href="/css/prism-duotone-sea.css" type="text/css"></head><body><header><div class="header-wrap clearfix"><a class="logo-wrap ink" href="/"><img class="logo" src="/logo.png" alt=""> <span class="site-name">刘哇勇的部落格</span></a><div class="menu-wrap"><div class="header-burger" onclick='this.parentNode.parentNode.classList.toggle("open")'><div></div></div></div><nav class="header-nav"><ul><li class="nav-item ink"><a class="nav-link" href="/">首页</a></li><li class="nav-item ink"><a class="nav-link" href="/archives">归档</a></li><li class="nav-item ink"><a class="nav-link" href="/about">关于</a></li><li class="nav-item ink"><a class="nav-link" href="/atom.xml">订阅</a></li></ul></nav></div></header><div class="container clearfix"><div class="col col-sidebar"></div><div class="col col-main"><article><h1>Angular条件路由</h1><section class="post-info"><div class="post-date"><i class="material-icons md-dark">watch_later</i> 2 年前</div><div class="post-categories"><i class="material-icons md-dark">folder</i> <a class="category-link" href="/categories/技术/">技术</a></div><div class="post-tags"><i class="material-icons md-dark">local_offer</i> <a class="tag-link" href="/tags/anular/">anular</a></div></section><section class="post-content"><p>对于Web程序通常会有这样的需求：针对不同的情况，我们希望用户进入站点后打开不同的页面。 写一下Web程序的时候，会有这样的需求：根据用户的类型，将用户导向不同的页面。 譬如，对于非注册用户，打开站点后导向到注册页面; 或者，以之前做的一个项目为例，对于普通用户，打开培训页面，而培训合格的用户，我们希望默认打开管理页面。</p><p>这样的路由控制当然可以由后端来做。</p><a id="more"></a><p>当使用了Angular这样的前端框架时，路由由前端控制并且是事先配好的（当然，这种情况下也不是说后端就不能控制路由了）。 一个典型的angular示例如下面代码所示：</p><pre class="language-js"><code class="language-js"><span class="token keyword">var</span> app <span class="token operator">=</span> angular<span class="token punctuation">.</span><span class="token function">module</span><span class="token punctuation">(</span><span class="token string">'myApp'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">config</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'$routeProvider'</span><span class="token punctuation">,</span>
    <span class="token keyword">function</span><span class="token punctuation">(</span>$routeProvider<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        $routeProvider<span class="token punctuation">.</span>
        <span class="token comment" spellcheck="true">//培训页面</span>
        <span class="token function">when</span><span class="token punctuation">(</span><span class="token string">'/home'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
            templateUrl<span class="token punctuation">:</span> <span class="token string">'views/home.html'</span><span class="token punctuation">,</span>
            controller<span class="token punctuation">:</span> <span class="token string">'HomeCtrl'</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
        <span class="token comment" spellcheck="true">//管理</span>
        <span class="token function">when</span><span class="token punctuation">(</span><span class="token string">'/auth'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
            templateUrl<span class="token punctuation">:</span> <span class="token string">'views/auth.html'</span><span class="token punctuation">,</span>
            controller<span class="token punctuation">:</span> <span class="token string">'AuthCtrl'</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
        <span class="token function">otherwise</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            redirectTo<span class="token punctuation">:</span> <span class="token string">'/'</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>这里不深入讨论完整的权限控制，用户当然可以手动更改URL来打开管理页面，但你可以选择不展示内容而是给个提示“无权限”之类的，总之这里不讨论，这里要说的就是我们有能力根据条件更改Angular路由的默认页面。</p><p>如果我们不做作何处理，根据现在的配置，默认是打开培训页面。为了对已经通过培训的用户默认打开管理页面，首先我们要知道当前用户的身份，然后判断是否该跳转。</p><p>Angular模块的<code>run</code>函数，是最接近主程序启动的地方，可以在这里进行判断与重定向。 所以更新后的代码如下：</p><pre class="language-js"><code class="language-js"><span class="token keyword">var</span> app <span class="token operator">=</span> angular<span class="token punctuation">.</span><span class="token function">module</span><span class="token punctuation">(</span><span class="token string">'myApp'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">config</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'$routeProvider'</span><span class="token punctuation">,</span>
    <span class="token keyword">function</span><span class="token punctuation">(</span>$routeProvider<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        $routeProvider<span class="token punctuation">.</span>
        <span class="token comment" spellcheck="true">//首页</span>
        <span class="token function">when</span><span class="token punctuation">(</span><span class="token string">'/home'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
            templateUrl<span class="token punctuation">:</span> <span class="token string">'views/home.html'</span><span class="token punctuation">,</span>
            controller<span class="token punctuation">:</span> <span class="token string">'HomeCtrl'</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
        <span class="token comment" spellcheck="true">//注册页</span>
        <span class="token function">when</span><span class="token punctuation">(</span><span class="token string">'/auth'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
            templateUrl<span class="token punctuation">:</span> <span class="token string">'views/auth.html'</span><span class="token punctuation">,</span>
            controller<span class="token punctuation">:</span> <span class="token string">'AuthCtrl'</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
        <span class="token function">otherwise</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            redirectTo<span class="token punctuation">:</span> <span class="token string">'/'</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'$location'</span><span class="token punctuation">,</span> <span class="token string">'$http'</span><span class="token punctuation">,</span>
    <span class="token keyword">function</span><span class="token punctuation">(</span>$location<span class="token punctuation">,</span> $http<span class="token punctuation">)</span> <span class="token punctuation">{</span>

        $http<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'path/to/get/user/data'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
        <span class="token function">success</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment" spellcheck="true">//拿到用户数据，判断用户类型，然后定位到相应的页面</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>member<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment" spellcheck="true">//如果是合格用户，转向管理页面</span>
                $location<span class="token punctuation">.</span><span class="token function">path</span><span class="token punctuation">(</span><span class="token string">'/auth'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
        <span class="token function">error</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>向模块添加<code>run</code>函数，首先发起一个请求获取用户数据，根据返回的数据进行判断，然后使用<code>$location.path</code>来重新路由。</p><h2 id="参考及引用"><a href="/2015/03/08/redirect-before-routing-in-angular/#参考及引用" class="headerlink" title="参考及引用"></a>参考及引用</h2><ul><li><a href="https://docs.angularjs.org/guide/module" target="_blank" rel="external">Angular Modeule Run Blocks</a></li></ul></section></article><div class="pager"><a class="post-prev pager-item" href="/2016/01/01/batch-convert-text-encoding-from-gbk-2-utf8/"><strong class="article-nav-caption">上一篇</strong><p class="post-nav-title">GBK批量转UTF8</p></a><a class="post-next pager-item" href="/2015/01/18/all-this/"><strong class="article-nav-caption">下一篇</strong><p class="post-nav-title">详解this</p></a></div><div class="comment-section"><div id="disqus_thread"></div><script>var disqus_config=function(){this.page.url="https://wayou.github.io/2015/03/08/redirect-before-routing-in-angular/",this.page.identifier="_posts/2015-03-08-redirect-before-routing-in-angular.md"};!function(){var e=document,t=e.createElement("script");t.src="//wayou.disqus.com/embed.js",t.setAttribute("data-timestamp",+new Date),(e.head||e.body).appendChild(t)}()</script></div></div></div><footer class="footer"><p>由<a href="http://hexo.io/" target="_blank">Hexo</a>强力驱动，搭载<a title="under developing..." href="javascript:;">末名</a>主题</p><p>&copy; 2017 Wayou Liu</p></footer><script src="/lib/waves/waves.js"></script><script src="/lib/tocbot/tocbot.js"></script><script src="/js/main.js"></script></body>