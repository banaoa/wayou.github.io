<!DOCTYPE html><head><title>正确地缩写 document.querySelector | 刘哇勇的部落格</title><meta charset="UTF-8"><link href="/favicon.ico" rel="icon"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="author" content="Wayou Liu"><link rel="canonical" href="https://wayou.github.io/2017/06/17/alias-for-document-querySelector/"><meta name="description" content="北京的夕阳，伴随淡淡的霾殇。从写字楼望去，光线是那么昏黄。没有孤雁，也没有霞光，遥想当年，还是 jQuery 独霸一方。那时的我们，写程序都习惯了使用 $，至少在对美元符号的喜爱上，与 PHP 达成了一致。"><meta name="keywords" content="javascript,jquery,document,querySelector"><meta property="og:type" content="article"><meta property="og:title" content="正确地缩写 document.querySelector"><meta property="og:url" content="https://wayou.github.io/2017/06/17/alias-for-document-querySelector/index.html"><meta property="og:site_name" content="刘哇勇的部落格"><meta property="og:description" content="北京的夕阳，伴随淡淡的霾殇。从写字楼望去，光线是那么昏黄。没有孤雁，也没有霞光，遥想当年，还是 jQuery 独霸一方。那时的我们，写程序都习惯了使用 $，至少在对美元符号的喜爱上，与 PHP 达成了一致。"><meta property="og:image" content="https://wayou.github.io/2017/06/17/alias-for-document-querySelector/1.png"><meta property="og:image" content="https://wayou.github.io/2017/06/17/alias-for-document-querySelector/2.png"><meta property="og:updated_time" content="2017-06-23T16:46:40.455Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="正确地缩写 document.querySelector"><meta name="twitter:description" content="北京的夕阳，伴随淡淡的霾殇。从写字楼望去，光线是那么昏黄。没有孤雁，也没有霞光，遥想当年，还是 jQuery 独霸一方。那时的我们，写程序都习惯了使用 $，至少在对美元符号的喜爱上，与 PHP 达成了一致。"><meta name="twitter:image" content="https://wayou.github.io/2017/06/17/alias-for-document-querySelector/1.png"><meta name="twitter:creator" content="@liuwayong"><link rel="publisher" href="+WayouLiu"><meta property="fb:admins" content="liuwayong"><meta property="fb:app_id" content="liuwayong"><link href="/img/logo.png" rel="shortcut icon"><link rel="stylesheet" href="/lib/waves/waves.css"><link rel="stylesheet" href="/lib/tocbot/tocbot.css"><link rel="stylesheet" href="/style/style.css"><script>!function(e,a,t,n,c,o,s){e.GoogleAnalyticsObject=c,e[c]=e[c]||function(){(e[c].q=e[c].q||[]).push(arguments)},e[c].l=1*new Date,o=a.createElement(t),s=a.getElementsByTagName(t)[0],o.async=1,o.src="//www.google-analytics.com/analytics.js",s.parentNode.insertBefore(o,s)}(window,document,"script",0,"ga"),ga("create","UA-46794744-6","auto"),ga("send","pageview")</script><link rel="stylesheet" href="/css/prism-atom-dark.css" type="text/css"></head><body><header><div class="header-wrap clearfix"><div class="header-content"><a class="logo-wrap ink" href="/"><img class="logo" src="/logo.png" alt=""> <span class="site-name">刘哇勇的部落格</span></a><div class="menu-wrap"><div class="header-burger" onclick='document.body.classList.toggle("open")'><div></div></div></div></div><nav class="header-nav"><ul><li class="nav-item ink"><a class="nav-link" href="/">首页</a></li><li class="nav-item ink"><a class="nav-link" href="/archives">归档</a></li><li class="nav-item ink"><a class="nav-link" href="/about">关于</a></li><li class="nav-item ink"><a class="nav-link" href="/atom.xml">订阅</a></li></ul></nav></div></header><div class="container clearfix"><div class="col col-sidebar"></div><div class="col col-main"><article><h1>正确地缩写 document.querySelector</h1><section class="post-info"><div class="post-date"><i class="material-icons md-dark">watch_later</i> 2017-06-17 17:06:00</div><div class="post-categories"><i class="material-icons md-dark">folder</i> <a class="category-link" href="/categories/JavaScript/">JavaScript</a></div><div class="post-tags"><i class="material-icons md-dark">local_offer</i> <a class="tag-link" href="/tags/document/">document</a>, <a class="tag-link" href="/tags/javascript/">javascript</a>, <a class="tag-link" href="/tags/jquery/">jquery</a>, <a class="tag-link" href="/tags/querySelector/">querySelector</a></div></section><section class="post-content"><p>北京的夕阳，伴随淡淡的霾殇。从写字楼望去，光线是那么昏黄。没有孤雁，也没有霞光，遥想当年，还是 jQuery 独霸一方。那时的我们，写程序都习惯了使用 <code>$</code>，至少在对美元符号的喜爱上，与 PHP 达成了一致。</p><a id="more"></a><p>当然，我并不讨论语言，我只说前端。</p><p>在 React 大行其道的如今，很少再看到 jQuery 的身影，是它离开了我们吗，还是我们选择了不挽留。总之，我们返璞归真，重新写起了原生的 JavaScript，这无疑是原教主义者们的胜利并且值得庆祝的时代。</p><p>使用 jQuery，对于 DOM 操作毫不费力。没了 jQuery，好多小伙伴像断臂杨过，生活只能靠姑姑处理。倒不是说原生不能处理，只是方法很繁琐：</p><ul><li><code>document.getElementById</code></li><li><code>document.getElementsByClass</code></li><li><code>document.getElementsByName</code></li><li><code>document.getElementsByTagName</code></li></ul><p>方法都很全，像牙科医生的工具包。 好在后来又加上了类 jQuery 的选择方式，</p><ul><li><code>document.querySelector</code></li><li><code>document.querySelectorAll</code></li></ul><p>那这样呢我们又能愉快地使用单一的方法进行多种类型的 DOM 选择了。</p><p>即使这样，还是给我们留下了一些不爽，那就是名字太长。大家应该都知道电影里反派的统一死法吧————死于话多。所以本着能省则省，能少敲几个字母就绝不多敲的原则，我们很是需要对这些方法进行一次包装，或者说取个别名。对，最好就用熟悉的 <code>$</code> 。</p><p>于是我们说干就干，在不到四分之一柱香的时间，我们撸出了如下代码：</p><pre class="language-js"><code class="language-js"><span class="token keyword">var</span> $ <span class="token operator">=</span> document<span class="token punctuation">.</span>querySelectorAll<span class="token punctuation">;</span>
</code></pre><p>以及测试代码：</p><pre class="language-js"><code class="language-js">console<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'body'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>通过只有少数人才知道的快捷键组合 <kbd>⌘</kbd>+<kbd>⌥</kbd>+<kbd>j</kbd>，我们娴熟地唤出了浏览器控制台进行测试。</p><p><img src="/2017/06/17/alias-for-document-querySelector/1.png" alt="没有按照程序员设想方式执行的代码"><span class="image-caption">没有按照程序员设想方式执行的代码</span></p><p>但是测试之后，我们开始怀疑人生。这便是本文存在的意义。它帮妳拨开云雾见日升，拥有不再怀疑的人生。</p><p>这里报错的原因是 <code>querySelectorAll</code> 所需的执行上下文必需是 <code>document</code>，而我们赋值到 <code>$</code> 调用后上下文变成了全局 <code>window</code>。</p><p>明白了这个道理后，我们再花不到四分之一柱香的时间，就改写了之前的版本，释出了正确的版本，这个版本里面，我们用正确的姿势去 alias。</p><pre class="language-js"><code class="language-js"><span class="token keyword">var</span> $ <span class="token operator">=</span> document<span class="token punctuation">.</span>querySelectorAll<span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>document<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>然后我们再测试，本来这次测试是没有必要的，至少应该像一个信心满满的程序员那样去喝杯咖啡了。</p><p><img src="/2017/06/17/alias-for-document-querySelector/2.png" alt="不出意外的正常执行"><span class="image-caption">不出意外的正常执行</span></p><p>对于 <code>querSelector</code> 同理，它的上下文也是 <code>document</code>。</p><p>为了使用方便，我们可以将其他一系列的 DOM 选择方法都给上简写。</p><pre class="language-js"><code class="language-js"><span class="token keyword">var</span> query <span class="token operator">=</span> document<span class="token punctuation">.</span>querySelector<span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>document<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> queryAll <span class="token operator">=</span> document<span class="token punctuation">.</span>querySelectorAll<span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>document<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> fromId <span class="token operator">=</span> document<span class="token punctuation">.</span>getElementById<span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>document<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> fromClass <span class="token operator">=</span> document<span class="token punctuation">.</span>getElementsByClassName<span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>document<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> fromTag <span class="token operator">=</span> document<span class="token punctuation">.</span>getElementsByTagName<span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>document<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>需要注意的地方是，这些方法返回的要么是单个 <a href="https://developer.mozilla.org/en-US/docs/Web/API/Node" target="_blank" rel="external">Node</a> 节点，要么是 <a href="https://developer.mozilla.org/en-US/docs/Web/API/NodeList" target="_blank" rel="external">NodeList</a> 而 NodeLis 是类数组的对象，但并不是真正的数组，所以拿到之后不能直接使用 <code>map</code>,<code>forEach</code> 等方法。</p><p>正确的操作姿势应该是：</p><pre class="language-js"><code class="language-js">Array<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>map<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">'button'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span>element<span class="token punctuation">,</span>index<span class="token punctuation">)</span><span class="token punctuation">{</span>
    element<span class="token punctuation">.</span>onclick <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><h2 id="相关链接"><a href="/2017/06/17/alias-for-document-querySelector/#相关链接" class="headerlink" title="相关链接"></a>相关链接</h2><ul><li><a href="https://stackoverflow.com/questions/13383886/making-a-short-alias-for-document-queryselectorall" target="_blank" rel="external">https://stackoverflow.com/questions/13383886/making-a-short-alias-for-document-queryselectorall</a></li></ul></section></article><div class="pager"><a class="post-next pager-item" href="/2017/06/17/storage-in-priavate-mode/"><strong class="article-nav-caption">下一篇</strong><p class="post-nav-title truncate-text">Safari Private 模式下 localStorage 的问题</p></a></div><div class="comment-section"><div id="disqus_thread"></div><script>var disqus_config=function(){this.page.url="https://wayou.github.io/2017/06/17/alias-for-document-querySelector/",this.page.identifier="_posts/2017-06-17-alias-for-document-querySelector.md"};!function(){var e=document,t=e.createElement("script");t.src="//wayou.disqus.com/embed.js",t.setAttribute("data-timestamp",+new Date),(e.head||e.body).appendChild(t)}()</script></div></div></div><footer class="footer"><p>由<a href="http://hexo.io/" target="_blank">Hexo</a>强力驱动，搭载<a title="under developing..." href="javascript:;">末名</a>主题</p><p>&copy; 2017 Wayou Liu</p></footer><script src="/lib/waves/waves.js"></script><script src="/lib/tocbot/tocbot.js"></script><script src="/js/main.js"></script></body>